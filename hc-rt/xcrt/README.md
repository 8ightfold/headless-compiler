# XCRT

This folder implements startup and the C runtime for HC.

Many compilers depend on the CRT in some form, Clang is no exception.
For example, some of the builtins (``*_strlen``, ``*_abort``, ...)
just call the CRT functions, and this means we need to provide
our own definitions. ``thread_local`` also relies on an API called
["Emulated TLS"](http://www.chiark.greenend.org.uk/doc/gcc-4.9-doc/gccint.html#Emulated-TLS),
which we implement in ``Phase1/Emutls.cpp``.

The CRT also handles entry/startup. Many people are under the impression that ``main`` is *the*
entry point for programs, and while it is the C++ language entry point, it is not the program's.
The real [entry point](https://en.wikipedia.org/wiki/Entry_point) depends on the platform;
for Windows it is ``mainCRTStartup`` (can be anything, but GCC/Clang are weird about it),
and for most others, ``_start``. Before you ever reach main, you have to initialize C globals,
call global constructors, parse ``argv``/``envp``, and much more.

The top level implementations are:

- ``Phase0``: The entry point, constructor/cookie setup
- ``Phase1``: Static init, TLS definitions, argv parsing, etc.
- ``String``: Utilities for strings, such as ``strlen`` and ``strcmp``.
- ``BuiltinOverrides``: Definitions provided for any ``__builtin_*`` which links to the CRT.
- ``GlobalXtors.hpp``: Definitions of the internal ctor/dtor sequence generated by the linker.
